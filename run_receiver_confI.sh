#!/bin/bash# Configuration I: BW=120Mbps, RTT=10ms, MTU=1500BINTERFACE=enp2s0BIND_IP=0.0.0.0# 1. Set MTUecho 'Setting MTU to 1500 on $INTERFACE...'sudo ifconfig $INTERFACE mtu 1500# 2. Set RTT (tc netem)echo 'Setting RTT delay 10ms on $INTERFACE...'# Reset existing tc qdiscssudo tc qdisc del dev $INTERFACE root 2>/dev/null || true# Add netem delaysudo tc qdisc add dev $INTERFACE root netem delay 10ms# 3. Start multiple iperf3 Servers (one per flow)# iperf3 can only handle one client per server instance,# so we need to start multiple servers on different ports.echo 'Starting 50 iperf3 server instances on ports 5201-5250...'echo "Binding to IP: $BIND_IP"# Array to store server PIDsdeclare -a IPERF_PIDSfor port in $(seq 5201 5250); do  iperf3 -s -B $BIND_IP -p $port -D  IPERF_PIDS+=($!)doneecho '50 iperf3 servers started (ports 5201-5250) on $BIND_IP.'echo 'Press Ctrl+C to stop all servers.'# Function to cleanup servers on exitcleanup() {  echo ''  echo 'Stopping all iperf3 servers...'    # Send SIGTERM first for graceful shutdown  for pid in "${IPERF_PIDS[@]}"; do    kill -TERM $pid 2>/dev/null || true  done    # Wait a moment for graceful shutdown  sleep 1    # Force kill any remaining processes  for pid in "${IPERF_PIDS[@]}"; do    kill -9 $pid 2>/dev/null || true  done    # Also cleanup by port pattern  pkill -9 -f "iperf3 -s.*-p 52" 2>/dev/null || true    echo 'All servers stopped.'  exit 0}trap cleanup SIGINT SIGTERM EXIT# Wait and show connection status periodicallyecho 'Receiver is ready. Waiting for traffic...'echo "You can monitor traffic with: ss -tn | grep -E '520[0-9]' or netstat -tn | grep -E '520[0-9]'"echo ''# Show connection count every 10 secondswhile true; do  CONN_COUNT=$(ss -tn 2>/dev/null | grep -cE ':520[0-9]' || echo 0)  echo "[$(date '+%H:%M:%S')] Active iperf3 connections: $CONN_COUNT"  sleep 10done